<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles/admin.css">
</head>
<body class="admin-body">
  <%- include('admin-navbar') %>

  <div class="admin-container">
    <div class="admin-title">Dashboard</div>
    <div class="admin-subtitle">Overview of store performance and stock.</div>

    <div class="row g-3 mt-3">
      <div class="col-md-3">
        <div class="admin-stat">
          <h3><%= stats.totalProducts %></h3>
          <div class="admin-subtitle">Products</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="admin-stat">
          <h3><%= stats.totalUsers %></h3>
          <div class="admin-subtitle">Users Registered</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="admin-stat">
          <h3><%= stats.totalOrders %></h3>
          <div class="admin-subtitle">Orders Total</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="admin-stat">
          <h3>$<%= Number(stats.revenueToday).toFixed(2) %></h3>
          <div class="admin-subtitle">Revenue Today</div>
        </div>
      </div>
    </div>

    <div class="d-flex flex-wrap gap-2 mt-4">
      <a href="/admin/add-product" class="admin-btn admin-btn-primary">Add Product</a>
      <a href="/admin/inventory" class="admin-btn admin-btn-secondary">Manage Inventory</a>
      <a href="/admin/orders" class="admin-btn admin-btn-secondary">Orders</a>
      <a href="/admin/reviews" class="admin-btn admin-btn-secondary">Reviews</a>
      <a href="/admin/vouchers" class="admin-btn admin-btn-secondary">Vouchers</a>
      <a href="/admin/users" class="admin-btn admin-btn-secondary">Users</a>
    </div>

    <div class="admin-card mt-4">
      <h4 class="mb-3">Top Selling Products</h4>
      <% if (bestProducts.length === 0) { %>
        <p class="admin-subtitle">No sales yet.</p>
      <% } else { %>
        <ul class="list-group">
          <% bestProducts.forEach(p => { %>
            <li class="list-group-item d-flex justify-content-between">
              <span><%= p.productName %></span>
              <span class="admin-badge admin-badge-success"><%= p.soldQty %> sold</span>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>

    <div class="admin-card">
      <h4 class="mb-3">Low Stock Items</h4>
      <% if (lowStock.length === 0) { %>
        <p class="admin-subtitle">All stock levels are healthy.</p>
      <% } else { %>
        <ul class="list-group">
          <% lowStock.forEach(p => { %>
            <li class="list-group-item d-flex justify-content-between">
              <span><%= p.productName %></span>
              <span class="admin-badge admin-badge-danger"><%= p.quantity %> left</span>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>

    <div class="admin-card">
      <h4 class="mb-3">Monthly Revenue</h4>
      <canvas id="revenueChart"></canvas>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const monthlyLabels = JSON.parse(`<%- JSON.stringify(monthlyRevenue.map(m => m.month)) %>`);
    const monthlyData   = JSON.parse(`<%- JSON.stringify(monthlyRevenue.map(m => Number(m.revenue))) %>`);

    new Chart(document.getElementById('revenueChart'), {
      type: 'line',
      data: {
        labels: monthlyLabels,
        datasets: [{
          label: 'Monthly Revenue ($)',
          data: monthlyData,
          borderColor: '#3b5b2a',
          backgroundColor: 'rgba(59, 91, 42, 0.15)',
          tension: 0.3,
          borderWidth: 2,
          pointRadius: 4
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  </script>
</body>
</html>
