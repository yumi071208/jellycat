<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Orders | Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles/admin.css">
</head>
<body class="admin-body">
  <%- include('admin-navbar') %>

  <div class="admin-container">
    <div class="admin-title">Orders</div>
    <div class="admin-subtitle">Track, update, and manage customer orders.</div>

    <div class="admin-card mt-3">
      <div class="table-responsive admin-table">
        <table class="table table-bordered align-middle mb-0 text-center">
          <thead>
            <tr>
              <th>ID</th>
              <th>Customer</th>
              <th>Email</th>
              <th>Delivery</th>
              <th>Total</th>
              <th>Status</th>
              <th>Placed At</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% orders.forEach(o => { %>
              <tr>
                <td><%= o.id %></td>
                <td><%= o.username %></td>
                <td><%= o.email %></td>
                <td><%= o.delivery_method %></td>
                <td>$<%= Number(o.total || 0).toFixed(2) %></td>
                <td>
                  <form method="POST" action="/admin/orders/<%= o.id %>/status" class="d-flex justify-content-center gap-2">
                    <select name="status" class="form-select form-select-sm">
                      <option value="Pending" <%= o.status === 'Pending' ? 'selected' : '' %>>Pending</option>
                      <option value="Preparing" <%= o.status === 'Preparing' ? 'selected' : '' %>>Preparing</option>
                      <option value="Ready for pickup" <%= o.status === 'Ready for pickup' ? 'selected' : '' %>>Ready for pickup</option>
                      <option value="Out for delivery" <%= o.status === 'Out for delivery' ? 'selected' : '' %>>Out for delivery</option>
                      <option value="Completed" <%= o.status === 'Completed' ? 'selected' : '' %>>Completed</option>
                      <option value="Cancelled" <%= o.status === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
                    </select>
                    <button class="admin-btn admin-btn-primary">Update</button>
                  </form>
                </td>
                <td><%= new Date(o.created_at).toLocaleString() %></td>
                <td>
                  <a href="/invoice/<%= o.id %>" class="admin-btn admin-btn-secondary">View Invoice</a>
                  <form method="POST" action="/admin/orders/<%= o.id %>/refund" style="display:inline-block">
                    <button class="admin-btn admin-btn-danger" onclick="return confirm('Mark as cancelled?')">Refund / Cancel</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
