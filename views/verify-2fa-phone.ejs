<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verify Phone | JellyMart</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles/theme.css">
</head>

<body class="auth-page">
  <%- include('navbar') %>

  <div class="container d-flex justify-content-center mt-4">
    <div class="auth-card w-100" style="max-width: 520px;">
      <div class="text-center mb-2 text-uppercase text-muted" style="letter-spacing: 0.12em; font-size: 12px;">
        Step 2 / Phone Verification
      </div>
      <h2 class="text-center">Verify Your Phone</h2>
      <p class="text-center text-muted">
        For security reasons, please enter the one-time code sent to your registered number
        <strong><%= phoneMasked || '***-***-****' %></strong>.
      </p>

      <div class="text-center mb-3">
        <span class="text-muted">Demo code:</span>
        <strong><%= demoCode %></strong>
      </div>

      <% if (errors && errors.length) { %>
        <div class="alert alert-danger"><%= errors[0] %></div>
      <% } %>

      <form action="/login/verify-phone" method="POST" id="otp-form">
        <input type="hidden" name="code" id="otp-code">

        <div class="otp-inputs mb-4">
          <input class="otp-input" inputmode="numeric" maxlength="1" autocomplete="one-time-code">
          <input class="otp-input" inputmode="numeric" maxlength="1">
          <input class="otp-input" inputmode="numeric" maxlength="1">
          <input class="otp-input" inputmode="numeric" maxlength="1">
          <input class="otp-input" inputmode="numeric" maxlength="1">
          <input class="otp-input" inputmode="numeric" maxlength="1">
        </div>

        <button type="submit" class="pastel-btn w-100">Verify</button>
      </form>

      <div class="text-center mt-3 text-muted">Mock only â€” no real 2FA is performed.</div>
      <div class="text-center mt-2">
        <a href="/login" class="text-muted">Back to login</a>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const inputs = Array.from(document.querySelectorAll('.otp-input'));
      const codeField = document.getElementById('otp-code');

      function updateCode() {
        codeField.value = inputs.map(i => i.value || '').join('');
      }

      inputs.forEach((input, idx) => {
        input.addEventListener('input', (e) => {
          const value = e.target.value.replace(/[^0-9]/g, '');
          e.target.value = value;
          if (value && idx < inputs.length - 1) {
            inputs[idx + 1].focus();
          }
          updateCode();
        });

        input.addEventListener('keydown', (e) => {
          if (e.key === 'Backspace' && !e.target.value && idx > 0) {
            inputs[idx - 1].focus();
          }
        });
      });

      document.getElementById('otp-form').addEventListener('submit', updateCode);
    })();
  </script>
</body>
</html>
